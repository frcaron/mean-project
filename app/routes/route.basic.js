var jwt = require('jsonwebtoken');
var tokenUtils = require('./../../config/tokenUtils');

module.exports = function(router) {

	// =========================================================================================
	// Public ==================================================================================
	// =========================================================================================

	

	// =========================================================================================
	// Middleware ==============================================================================
	// =========================================================================================

	// Token verification
	router.use(function(req, res, next) {
		
		var token = req.body.token || req.param('token') || req.headers['x-access-token'];
		
		if(token) {
			jwt.verify(token, tokenUtils.secret, function(err, decoded) {
				if(!err) {
					// Follow token
					req.decoded = decoded;
				}
			});
		}
		
		next();
	});

	// =========================================================================================
	// Private =================================================================================
	// =========================================================================================

	
};